<config>
	<globalProperties>
	  <globalProperty>
		<property>emrapi.sqlSearch.awaitingVitals</property>
		<value>select distinct concat( ifnull(pn.given_name,'') ,' ', pn.family_name ) as name, 
			pi.identifier as identifier, 
			concat("",p.uuid) as uuid, 
			concat("",v.uuid) as activeVisitUuid, 
			IF(va.value_reference = "Admitted", "true", "false") as hasBeenAdmitted 
		  from visit v 
		  join person_name pn on v.patient_id = pn.person_id and pn.voided = 0 
		  join patient_identifier pi on v.patient_id = pi.patient_id 
		  join patient_identifier_type pit on pi.identifier_type = pit.patient_identifier_type_id 
		  join global_property gp on gp.property="bahmni.primaryIdentifierType" and gp.property_value=pit.uuid 
		  join person p on p.person_id = v.patient_id
		  join location l on l.uuid = ${visit_location_uuid} and v.location_id = l.location_id 
		  left outer join visit_attribute va on va.visit_id = v.visit_id and va.attribute_type_id = ( 
			select visit_attribute_type_id from visit_attribute_type where name="Admission Status" 
		  ) and va.voided = 0 
		  where v.date_stopped is null AND v.voided = 0 and v.patient_id not in (
			select distinct person_id from obs
			join encounter on encounter.encounter_id = obs.encounter_id
			join visit on encounter.visit_id = visit.visit_id
			where visit.date_stopped is null and obs.form_namespace_and_path LIKE "Bahmni^Vital Signs.1/%"
			AND DATE(obs.date_created) = CURDATE() 
		  ) order by v.date_started asc
	  </value>
	  </globalProperty>
	  <globalProperty>
		<property>emrapi.sqlSearch.waitingRoom</property>
		<value>SELECT 
			DISTINCT Concat(
			  Ifnull(pn.given_name, ''), 
			  ' ', 
			  pn.family_name
			) AS NAME, 
			pi.identifier AS identifier, 
			Concat("", p.uuid) AS uuid, 
			Concat("", v.uuid) AS activeVisitUuid, 
			IF(
			  va.value_reference = "Admitted", "true", 
			  "false"
			) as hasbeenadmitted 
		  FROM 
			visit v 
			JOIN person_name pn ON v.patient_id = pn.person_id 
			AND pn.voided = 0 
			JOIN patient_identifier pi ON v.patient_id = pi.patient_id 
			JOIN patient_identifier_type pit ON pi.identifier_type = pit.patient_identifier_type_id 
			JOIN global_property gp ON gp.property = "bahmni.primaryIdentifierType" 
			AND gp.property_value = pit.uuid 
			JOIN person p ON p.person_id = v.patient_id 
			JOIN location l ON l.uuid = ${visit_location_uuid} 
			AND v.location_id = l.location_id 
			LEFT OUTER JOIN visit_attribute va ON va.visit_id = v.visit_id 
			AND va.attribute_type_id = (
			  SELECT 
				visit_attribute_type_id 
			  FROM 
				visit_attribute_type 
			  WHERE 
				NAME = "Admission Status"
			) 
			AND va.voided = 0 
		  WHERE 
			v.date_stopped IS NULL 
			AND v.voided = 0 
			AND v.patient_id IN (
			  SELECT 
				DISTINCT person_id 
			  FROM 
				obs 
				JOIN encounter ON encounter.encounter_id = obs.encounter_id 
				JOIN visit ON encounter.visit_id = visit.visit_id 
			  WHERE 
				visit.date_stopped IS NULL 
				AND obs.form_namespace_and_path LIKE "Bahmni^Vital Signs.1/%" 
				AND date(obs.date_created) = curdate()
			) 
			AND v.patient_id NOT IN (
			  SELECT 
				DISTINCT person_id 
			  FROM 
				obs 
				JOIN encounter ON encounter.encounter_id = obs.encounter_id 
				JOIN visit ON encounter.visit_id = visit.visit_id 
			  WHERE 
				visit.date_stopped IS NULL 
				AND (
				  obs.form_namespace_and_path LIKE "Bahmni^Consultation%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Echographie%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Historique%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Motif%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Nutrition.1/%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Planification%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Suivi%" 
				  OR obs.form_namespace_and_path LIKE "Bahmni^Vaccinations.1/%"
				) 
				AND date(obs.date_created) = curdate()
			) 
		  ORDER BY 
			v.date_started ASC
				  </value>
	  </globalProperty>
	</globalProperties>
  </config>
